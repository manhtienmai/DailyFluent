{% extends "layouts/sidebar_layout.html" %}
{% load static %}

{% block title %}English Flashcard | DailyFluent{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/flashcard.css' %}?v=20260115">
{% endblock %}

{% block content %}
<div class="df-fc-container">
  <!-- Header -->
  <div class="df-fc-header">
    <div>
      <h1 class="df-fc-title">ðŸ‡¬ðŸ‡§ English Flashcard</h1>
      {% if stats %}
      <div class="df-fc-stats">
        <span class="df-fc-stat df-fc-stat--learning">
          Learning: <strong>{{ stats.learning_count }}</strong>
        </span>
        <span class="df-fc-stat df-fc-stat--review">
          Review: <strong>{{ stats.review_count }}</strong>
        </span>
        <span class="df-fc-stat df-fc-stat--new">
          New: <strong>{{ stats.new_count }}</strong>
        </span>
      </div>
      {% endif %}
    </div>
    <div class="df-fc-counter">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
      <span id="fc-remaining">{{ states|length }}</span> cards
    </div>
  </div>

  <!-- Goal Ring -->
  <div class="df-fc-goal">
    <div class="df-fc-goal-ring">
      <svg viewBox="0 0 48 48">
        <circle class="df-fc-goal-ring-bg" cx="24" cy="24" r="18" />
        <circle id="fc-goal-ring" class="df-fc-goal-ring-progress" cx="24" cy="24" r="18"
          stroke-dasharray="113.1" stroke-dashoffset="113.1" />
      </svg>
      <div id="fc-goal-label" class="df-fc-goal-label">0%</div>
    </div>
    <div class="df-fc-goal-info">
      <div class="df-fc-goal-title">Daily Goal: 10 mins</div>
      <div id="fc-goal-minutes">0/10 phÃºt</div>
    </div>
  </div>

  {% if states %}
  <form id="csrf-form" class="hidden">
    {% csrf_token %}
  </form>

  <script id="flashcards-data" type="application/json">{{ cards_data_json|safe }}</script>

  <div id="flashcard-container">
    <!-- Progress Bar -->
    <div class="df-fc-progress">
      <div id="fc-progress-bar" class="df-fc-progress-bar" style="width: 0%"></div>
    </div>

    <!-- Error Message -->
    <div id="fc-error" class="df-fc-error hidden"></div>

    <!-- Flashcard -->
    <div class="df-fc-card-wrapper" id="fc-card-wrapper">
      <div class="df-fc-card">
        <!-- Front Side -->
        <div class="df-fc-front" id="fc-front">
          <div id="fc-main-word" class="df-fc-main-word df-fc-main-word--en"></div>
          <div id="fc-phonetic" class="df-fc-phonetic"></div>
          
          <button type="button" id="fc-flip-btn" class="df-fc-flip-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Flip
          </button>
        </div>

        <!-- Back Side -->
        <div class="df-fc-back hidden" id="fc-back">
          <!-- Header -->
          <div class="df-fc-back-header">
            <div id="fc-back-word" class="df-fc-back-word df-fc-back-word--en"></div>
            <div id="fc-back-reading" class="df-fc-reading"></div>
          </div>

          <!-- Sino Vietnamese (hidden for English) -->
          <div id="fc-sino-block" class="hidden">
            <span class="df-fc-label df-fc-label--sino">Ã‚m HÃ¡n Viá»‡t</span>
            <div id="fc-sino-vi" class="df-fc-sino"></div>
          </div>

          <!-- Definition -->
          <div id="fc-definition" style="margin-bottom: 1rem;">
            <span class="df-fc-label df-fc-label--definition">Definition</span>
            <div class="df-fc-definition"></div>
          </div>

          <!-- Meaning -->
          <div style="margin-bottom: 1rem;">
            <span class="df-fc-label df-fc-label--meaning">NghÄ©a</span>
            <div id="fc-meaning" class="df-fc-meaning"></div>
          </div>

          <!-- Example -->
          <div id="fc-example" class="df-fc-example hidden">
            <div style="display: flex; gap: 0.75rem;">
              <svg class="df-fc-example-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
                  clip-rule="evenodd" />
              </svg>
              <div style="flex: 1;">
                <div id="fc-example-text" class="df-fc-example-text"></div>
                <div id="fc-example-trans" class="df-fc-example-translation"></div>
              </div>
            </div>
          </div>

          <!-- Grade Buttons -->
          <div id="fc-grades" class="df-fc-grades">
            <button type="button" data-rating="again" class="df-fc-grade-btn df-fc-grade-btn--again">
              <span class="df-fc-grade-emoji">ðŸ˜µ</span>
              <span class="df-fc-grade-label">Again</span>
              <span class="df-fc-grade-interval" data-interval="again"></span>
            </button>

            <button type="button" data-rating="hard" class="df-fc-grade-btn df-fc-grade-btn--hard">
              <span class="df-fc-grade-emoji">ðŸ˜£</span>
              <span class="df-fc-grade-label">Hard</span>
              <span class="df-fc-grade-interval" data-interval="hard"></span>
            </button>

            <button type="button" data-rating="good" class="df-fc-grade-btn df-fc-grade-btn--good">
              <span class="df-fc-grade-emoji">ðŸ™‚</span>
              <span class="df-fc-grade-label">Good</span>
              <span class="df-fc-grade-interval" data-interval="good"></span>
            </button>

            <button type="button" data-rating="easy" class="df-fc-grade-btn df-fc-grade-btn--easy">
              <span class="df-fc-grade-emoji">ðŸ˜Œ</span>
              <span class="df-fc-grade-label">Easy</span>
              <span class="df-fc-grade-interval" data-interval="easy"></span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Completion Message -->
    <div id="fc-complete" class="df-fc-complete hidden">
      <div class="df-fc-complete-icon">ðŸŽ‰</div>
      <h2 class="df-fc-complete-title">Session Complete!</h2>
      <p class="df-fc-complete-text">
        You've completed {{ states|length }} cards in this session. Want to continue?
      </p>
      <a href="{% url 'vocab:flashcards_english' %}" class="df-fc-complete-btn">
        Continue Learning
      </a>
    </div>
  </div>

  {% else %}
  <!-- Empty State -->
  <div class="df-fc-empty">
    <div class="df-fc-empty-icon">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
    </div>
    <h2 class="df-fc-empty-title">No cards available</h2>
    <p class="df-fc-empty-text">
      There are no cards due for review. Add more vocabulary or check back later.
    </p>
  </div>
  {% endif %}
</div>

{% if states %}
<script src="{% static 'js/flashcard-core.js' %}?v=20260115"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  new FlashcardApp({
    language: 'english',
    containerId: 'flashcard-container',
    cardsDataId: 'flashcards-data',
    csrfFormId: 'csrf-form',
    gradeUrl: "{% url 'vocab:flashcard_grade_english' %}",
    streakStatusUrl: "{% url 'streak:status_api' %}",
    logTimeUrl: "{% url 'streak:log_flashcard_minutes' %}",
    goalMinutes: 10
  });
});
</script>
{% endif %}
{% endblock %}
