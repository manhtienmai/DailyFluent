{% extends "layouts/sidebar_layout.html" %}
{% load static %}

{% block title %}Vocabulary Sets | DailyFluent{% endblock %}

{% block extra_css %}
<style>
  /* =============================================
     Vocabulary Sets - Frosted Crystal Design
     ============================================= */

  /* Pastel Gradient Mesh Background */
  .sets-page {
    min-height: 100vh;
    background:
      radial-gradient(ellipse 70% 50% at 25% 30%, rgba(199, 210, 254, 0.45) 0%, transparent 50%),
      radial-gradient(ellipse 60% 45% at 75% 70%, rgba(251, 207, 232, 0.35) 0%, transparent 50%),
      radial-gradient(ellipse 50% 50% at 50% 10%, rgba(167, 243, 208, 0.25) 0%, transparent 45%),
      radial-gradient(ellipse 40% 40% at 90% 90%, rgba(254, 215, 170, 0.2) 0%, transparent 40%),
      linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
    background-attachment: fixed;
    padding: 1.25rem;
  }

  [data-theme="dark"] .sets-page {
    background:
      radial-gradient(ellipse 70% 50% at 25% 30%, rgba(99, 102, 241, 0.12) 0%, transparent 50%),
      radial-gradient(ellipse 60% 45% at 75% 70%, rgba(236, 72, 153, 0.08) 0%, transparent 50%),
      radial-gradient(ellipse 50% 50% at 50% 10%, rgba(16, 185, 129, 0.06) 0%, transparent 45%),
      linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
    background-attachment: fixed;
  }

  .sets-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  /* ========== GLASS PANELS ========== */
  .glass-panel {
    background: rgba(255, 255, 255, 0.72);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.8);
    border-radius: 16px;
    box-shadow:
      0 4px 24px -4px rgba(99, 102, 241, 0.1),
      0 8px 48px -8px rgba(99, 102, 241, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }

  [data-theme="dark"] .glass-panel {
    background: rgba(30, 41, 59, 0.75);
    border-color: rgba(148, 163, 184, 0.1);
    box-shadow:
      0 4px 24px -4px rgba(0, 0, 0, 0.35),
      0 8px 48px -8px rgba(0, 0, 0, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .glass-panel-light {
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(12px) saturate(150%);
    -webkit-backdrop-filter: blur(12px) saturate(150%);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 14px;
    box-shadow:
      0 2px 12px -2px rgba(99, 102, 241, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.7);
  }

  [data-theme="dark"] .glass-panel-light {
    background: rgba(30, 41, 59, 0.55);
    border-color: rgba(148, 163, 184, 0.08);
    box-shadow:
      0 2px 12px -2px rgba(0, 0, 0, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.03);
  }

  /* ========== HEADER SECTION ========== */
  .sets-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 1rem 1.25rem;
    margin-bottom: 1rem;
  }

  .sets-title-group h1 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    letter-spacing: -0.02em;
    margin-bottom: 0.125rem;
  }

  [data-theme="dark"] .sets-title-group h1 {
    color: #f1f5f9;
  }

  .sets-title-group p {
    font-size: 0.8125rem;
    color: #64748b;
  }

  [data-theme="dark"] .sets-title-group p {
    color: #94a3b8;
  }

  .sets-cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    font-size: 0.8125rem;
    font-weight: 600;
    border-radius: 10px;
    text-decoration: none;
    transition: all 0.2s ease;
    box-shadow:
      0 2px 8px -2px rgba(99, 102, 241, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .sets-cta-btn:hover {
    transform: translateY(-1px);
    box-shadow:
      0 4px 16px -4px rgba(99, 102, 241, 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .sets-cta-btn svg {
    width: 16px;
    height: 16px;
  }

  /* ========== FILTERS BAR ========== */
  .sets-filters {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  /* Tab Pills */
  .sets-tabs {
    display: flex;
    padding: 0.25rem;
    background: rgba(148, 163, 184, 0.12);
    border-radius: 10px;
  }

  [data-theme="dark"] .sets-tabs {
    background: rgba(51, 65, 85, 0.5);
  }

  .sets-tab {
    padding: 0.4375rem 0.875rem;
    border-radius: 8px;
    font-size: 0.8125rem;
    font-weight: 600;
    color: #64748b;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  [data-theme="dark"] .sets-tab {
    color: #94a3b8;
  }

  .sets-tab:hover {
    color: #475569;
  }

  [data-theme="dark"] .sets-tab:hover {
    color: #cbd5e1;
  }

  .sets-tab--active {
    background: rgba(255, 255, 255, 0.85);
    color: #1e293b;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
  }

  [data-theme="dark"] .sets-tab--active {
    background: rgba(99, 102, 241, 0.2);
    color: #a5b4fc;
  }

  /* Language Pills */
  .sets-lang-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .sets-lang-label {
    font-size: 0.625rem;
    font-weight: 700;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sets-lang-pills {
    display: flex;
    gap: 0.375rem;
  }

  .sets-lang-pill {
    padding: 0.375rem 0.75rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }

  .sets-lang-pill--default {
    background: rgba(255, 255, 255, 0.6);
    color: #64748b;
    border-color: rgba(148, 163, 184, 0.2);
  }

  [data-theme="dark"] .sets-lang-pill--default {
    background: rgba(51, 65, 85, 0.5);
    color: #94a3b8;
    border-color: rgba(148, 163, 184, 0.1);
  }

  .sets-lang-pill--default:hover {
    background: rgba(255, 255, 255, 0.85);
    border-color: rgba(99, 102, 241, 0.3);
    color: #6366f1;
  }

  [data-theme="dark"] .sets-lang-pill--default:hover {
    background: rgba(99, 102, 241, 0.15);
    color: #a5b4fc;
  }

  .sets-lang-pill--active {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    box-shadow: 0 2px 6px -2px rgba(99, 102, 241, 0.5);
  }

  .sets-lang-pill--en {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
    color: white;
    box-shadow: 0 2px 6px -2px rgba(59, 130, 246, 0.5);
  }

  .sets-lang-pill--jp {
    background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
    color: white;
    box-shadow: 0 2px 6px -2px rgba(239, 68, 68, 0.5);
  }

  /* ========== SETS GRID ========== */
  .sets-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 0.875rem;
  }

  @media (min-width: 640px) {
    .sets-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .sets-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* ========== SET CARD ========== */
  .set-card {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }

  .set-card:hover {
    transform: translateY(-3px);
    background: rgba(255, 255, 255, 0.88);
    border-color: rgba(99, 102, 241, 0.25);
    box-shadow:
      0 8px 32px -8px rgba(99, 102, 241, 0.18),
      0 16px 48px -16px rgba(99, 102, 241, 0.12),
      inset 0 1px 0 rgba(255, 255, 255, 0.95);
  }

  [data-theme="dark"] .set-card:hover {
    background: rgba(51, 65, 85, 0.7);
    border-color: rgba(99, 102, 241, 0.3);
    box-shadow:
      0 8px 32px -8px rgba(0, 0, 0, 0.35),
      0 16px 48px -16px rgba(0, 0, 0, 0.25);
  }

  /* Card Header */
  .set-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .set-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
  }

  .set-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.1875rem 0.5rem;
    border-radius: 6px;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .set-badge--toeic {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    box-shadow: 0 2px 6px -2px rgba(99, 102, 241, 0.4);
  }

  .set-badge--set-num {
    background: rgba(148, 163, 184, 0.12);
    color: #64748b;
    border: 1px solid rgba(148, 163, 184, 0.2);
  }

  [data-theme="dark"] .set-badge--set-num {
    background: rgba(148, 163, 184, 0.1);
    color: #94a3b8;
    border-color: rgba(148, 163, 184, 0.15);
  }

  .set-badge--jp {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(248, 113, 113, 0.15) 100%);
    color: #dc2626;
    border: 1px solid rgba(239, 68, 68, 0.25);
  }

  [data-theme="dark"] .set-badge--jp {
    background: rgba(239, 68, 68, 0.15);
    color: #f87171;
  }

  .set-badge--en {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(96, 165, 250, 0.15) 100%);
    color: #2563eb;
    border: 1px solid rgba(59, 130, 246, 0.25);
  }

  [data-theme="dark"] .set-badge--en {
    background: rgba(59, 130, 246, 0.15);
    color: #60a5fa;
  }

  /* Word Count */
  .set-word-count {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 6px;
    font-size: 0.6875rem;
    font-weight: 700;
    color: #059669;
    flex-shrink: 0;
  }

  [data-theme="dark"] .set-word-count {
    background: rgba(16, 185, 129, 0.15);
    color: #34d399;
  }

  .set-word-count svg {
    width: 12px;
    height: 12px;
  }

  /* Card Body */
  .set-card-body {
    flex: 1;
  }

  .set-title {
    font-size: 0.9375rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.375rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    transition: color 0.2s ease;
  }

  [data-theme="dark"] .set-title {
    color: #f1f5f9;
  }

  .set-card:hover .set-title {
    color: #6366f1;
  }

  [data-theme="dark"] .set-card:hover .set-title {
    color: #a5b4fc;
  }

  .set-desc {
    font-size: 0.8125rem;
    color: #64748b;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 0.75rem;
    min-height: 2.4em;
  }

  [data-theme="dark"] .set-desc {
    color: #94a3b8;
  }

  /* Card Footer */
  .set-card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(148, 163, 184, 0.12);
  }

  [data-theme="dark"] .set-card-footer {
    border-color: rgba(148, 163, 184, 0.08);
  }

  .set-owner {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.625rem;
    border-radius: 999px;
    font-size: 0.6875rem;
    font-weight: 600;
  }

  .set-owner svg {
    width: 12px;
    height: 12px;
  }

  .set-owner--mine {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(52, 211, 153, 0.12) 100%);
    color: #059669;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  [data-theme="dark"] .set-owner--mine {
    background: rgba(16, 185, 129, 0.15);
    color: #34d399;
    border-color: rgba(16, 185, 129, 0.25);
  }

  .set-owner--system {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(96, 165, 250, 0.12) 100%);
    color: #2563eb;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  [data-theme="dark"] .set-owner--system {
    background: rgba(59, 130, 246, 0.15);
    color: #60a5fa;
    border-color: rgba(59, 130, 246, 0.25);
  }

  .set-owner--user {
    background: rgba(148, 163, 184, 0.1);
    color: #64748b;
    border: 1px solid rgba(148, 163, 184, 0.15);
  }

  [data-theme="dark"] .set-owner--user {
    background: rgba(148, 163, 184, 0.1);
    color: #94a3b8;
  }

  .set-arrow {
    width: 18px;
    height: 18px;
    color: #94a3b8;
    transition: all 0.2s ease;
  }

  .set-card:hover .set-arrow {
    color: #6366f1;
    transform: translateX(3px);
  }

  [data-theme="dark"] .set-card:hover .set-arrow {
    color: #a5b4fc;
  }

  /* ========== EMPTY STATE ========== */
  .sets-empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem 1.5rem;
  }

  .sets-empty-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 1rem;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    border: 1px solid rgba(99, 102, 241, 0.15);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sets-empty-icon svg {
    width: 28px;
    height: 28px;
    color: #6366f1;
  }

  [data-theme="dark"] .sets-empty-icon svg {
    color: #a5b4fc;
  }

  .sets-empty h3 {
    font-size: 1rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.25rem;
  }

  [data-theme="dark"] .sets-empty h3 {
    color: #f1f5f9;
  }

  .sets-empty p {
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 1.25rem;
    max-width: 320px;
    margin-left: auto;
    margin-right: auto;
  }

  [data-theme="dark"] .sets-empty p {
    color: #94a3b8;
  }

  /* ========== PAGINATION ========== */
  .sets-pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    margin-top: 1.25rem;
    padding: 1rem;
  }

  .sets-page-btn {
    min-width: 36px;
    height: 36px;
    padding: 0 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 0.8125rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .sets-page-btn--nav {
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.8);
    color: #64748b;
    box-shadow: 0 1px 4px rgba(99, 102, 241, 0.06);
  }

  [data-theme="dark"] .sets-page-btn--nav {
    background: rgba(51, 65, 85, 0.5);
    border-color: rgba(148, 163, 184, 0.1);
    color: #94a3b8;
  }

  .sets-page-btn--nav:hover {
    background: rgba(255, 255, 255, 0.9);
    border-color: rgba(99, 102, 241, 0.3);
    color: #6366f1;
    transform: translateY(-1px);
  }

  [data-theme="dark"] .sets-page-btn--nav:hover {
    background: rgba(99, 102, 241, 0.15);
    color: #a5b4fc;
  }

  .sets-page-btn--nav svg {
    width: 18px;
    height: 18px;
  }

  .sets-page-info {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.8);
    border-radius: 10px;
    font-size: 0.8125rem;
    font-weight: 600;
    color: #475569;
    box-shadow: 0 1px 4px rgba(99, 102, 241, 0.05);
  }

  [data-theme="dark"] .sets-page-info {
    background: rgba(51, 65, 85, 0.5);
    border-color: rgba(148, 163, 184, 0.1);
    color: #cbd5e1;
  }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 640px) {
    .sets-page {
      padding: 0.875rem;
    }

    .sets-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.875rem;
      padding: 0.875rem 1rem;
    }

    .sets-cta-btn {
      width: 100%;
      justify-content: center;
    }

    .sets-filters {
      flex-direction: column;
      align-items: stretch;
      gap: 0.75rem;
      padding: 0.75rem;
    }

    .sets-tabs {
      width: 100%;
      justify-content: center;
    }

    .sets-tab {
      flex: 1;
      text-align: center;
    }

    .sets-lang-group {
      justify-content: center;
    }

    .set-card {
      padding: 0.875rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="sets-page">
  <div class="sets-container">

    <!-- Header -->
    <header class="glass-panel sets-header">
      <div class="sets-title-group">
        <h1>Bộ từ vựng</h1>
        <p>Quản lý và khám phá các bộ từ vựng</p>
      </div>
      <a href="{% url 'vocab:set_create' %}" class="sets-cta-btn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Tạo bộ mới
      </a>
    </header>

    <!-- Filters -->
    <section class="glass-panel-light sets-filters">
      <!-- Tabs -->
      <nav class="sets-tabs" aria-label="Set type" id="setsTabNav">
        <button type="button" data-tab="public"
           class="sets-tab {% if tab != 'my' %}sets-tab--active{% endif %}">
          Bộ công khai
        </button>
        {% if user.is_authenticated %}
        <button type="button" data-tab="my"
           class="sets-tab {% if tab == 'my' %}sets-tab--active{% endif %}">
          Bộ của tôi
        </button>
        {% endif %}
      </nav>

      <!-- Language Filter -->
      <div class="sets-lang-group" id="setsLangNav">
        <span class="sets-lang-label">Ngôn ngữ</span>
        <div class="sets-lang-pills">
          <button type="button" data-lang="all"
             class="sets-lang-pill {% if current_lang == 'all' %}sets-lang-pill--active{% else %}sets-lang-pill--default{% endif %}">
            Tất cả
          </button>
          <button type="button" data-lang="en"
             class="sets-lang-pill {% if current_lang == 'en' %}sets-lang-pill--en{% else %}sets-lang-pill--default{% endif %}">
            EN
          </button>
          <button type="button" data-lang="jp"
             class="sets-lang-pill {% if current_lang == 'jp' %}sets-lang-pill--jp{% else %}sets-lang-pill--default{% endif %}">
            JP
          </button>
        </div>
      </div>
    </section>

    <!-- Loading Spinner (hidden by default) -->
    <div id="setsLoadingSpinner" class="sets-loading" style="display: none;">
      <div class="sets-loading-spinner"></div>
    </div>

    <!-- Sets Grid -->
    <section class="sets-grid" aria-label="Vocabulary sets" id="setsGrid">
      {% for set in sets %}
      <article class="glass-panel-light set-card" data-owner="{{ set.owner.id|default:'' }}" data-lang="{{ set.language }}">
        <a href="{% url 'vocab:set_detail' set.pk %}" class="absolute inset-0 z-10" aria-hidden="true"></a>

        <!-- Card Header -->
        <div class="set-card-header">
          <div class="set-badges">
            {% if set.toeic_level %}
            <span class="set-badge set-badge--toeic">TOEIC {{ set.toeic_level }}</span>
            {% if set.set_number %}
            <span class="set-badge set-badge--set-num">Set {{ set.set_number }}</span>
            {% endif %}
            {% endif %}
            {% if set.language == 'jp' %}
            <span class="set-badge set-badge--jp">JP</span>
            {% elif set.language == 'en' %}
            <span class="set-badge set-badge--en">EN</span>
            {% endif %}
          </div>
          <div class="set-word-count">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            {{ set.items.count }}
          </div>
        </div>

        <!-- Card Body -->
        <div class="set-card-body">
          <h3 class="set-title">{{ set.title }}</h3>
          <p class="set-desc">{{ set.description|default:"Chưa có mô tả." }}</p>
        </div>

        <!-- Card Footer -->
        <div class="set-card-footer">
          {% if set.owner %}
            {% if set.owner == user %}
            <span class="set-owner set-owner--mine">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              Của tôi
            </span>
            {% else %}
            <span class="set-owner set-owner--user">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              {{ set.owner.username }}
            </span>
            {% endif %}
          {% else %}
          <span class="set-owner set-owner--system">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Hệ thống
          </span>
          {% endif %}

          <svg class="set-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
          </svg>
        </div>
      </article>

      {% empty %}
      <!-- Empty State -->
      <div class="glass-panel sets-empty" id="setsEmptyState">
        <div class="sets-empty-icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
        </div>
        <h3>Không tìm thấy bộ từ nào</h3>
        <p>Không tìm thấy bộ từ vựng nào phù hợp với bộ lọc của bạn. Hãy thử thay đổi tìm kiếm hoặc tạo bộ mới.</p>
        <a href="{% url 'vocab:set_create' %}" class="sets-cta-btn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          Tạo bộ mới
        </a>
      </div>
      {% endfor %}
    </section>

    <!-- Pagination -->
    {% if is_paginated %}
    <nav class="glass-panel-light sets-pagination" aria-label="Phân trang">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&tab={{ tab }}&lang={{ current_lang }}"
         class="sets-page-btn sets-page-btn--nav" aria-label="Trang trước">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      </a>
      {% endif %}

      <span class="sets-page-info">
        Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&tab={{ tab }}&lang={{ current_lang }}"
         class="sets-page-btn sets-page-btn--nav" aria-label="Trang sau">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
      {% endif %}
    </nav>
    {% endif %}

  </div>
</div>

<script>
(function() {
  const CURRENT_USER_ID = '{{ user.id|default:"" }}';
  let currentTab = '{{ tab|default:"public" }}';
  let currentLang = '{{ current_lang|default:"all" }}';

  // Cache all set cards for client-side filtering
  const allSetCards = Array.from(document.querySelectorAll('.set-card'));
  const setsGrid = document.getElementById('setsGrid');
  const emptyState = document.getElementById('setsEmptyState');

  function updateTabUI(activeTab) {
    document.querySelectorAll('#setsTabNav .sets-tab').forEach(btn => {
      btn.classList.toggle('sets-tab--active', btn.dataset.tab === activeTab);
    });
  }

  function updateLangUI(activeLang) {
    document.querySelectorAll('#setsLangNav .sets-lang-pill').forEach(btn => {
      const lang = btn.dataset.lang;
      btn.classList.remove('sets-lang-pill--active', 'sets-lang-pill--en', 'sets-lang-pill--jp', 'sets-lang-pill--default');
      
      if (lang === activeLang) {
        if (lang === 'en') btn.classList.add('sets-lang-pill--en');
        else if (lang === 'jp') btn.classList.add('sets-lang-pill--jp');
        else btn.classList.add('sets-lang-pill--active');
      } else {
        btn.classList.add('sets-lang-pill--default');
      }
    });
  }

  function filterSets() {
    let visibleCount = 0;

    allSetCards.forEach(card => {
      const ownerId = card.dataset.owner;
      const lang = card.dataset.lang;
      
      // Tab filter
      let tabMatch = true;
      if (currentTab === 'my') {
        tabMatch = ownerId === CURRENT_USER_ID;
      }
      // 'public' tab shows all (already filtered by backend to show public + user's)

      // Language filter
      let langMatch = true;
      if (currentLang !== 'all') {
        langMatch = lang === currentLang;
      }

      const show = tabMatch && langMatch;
      card.style.display = show ? '' : 'none';
      
      // Animate entry
      if (show) {
        visibleCount++;
        card.style.opacity = '0';
        card.style.transform = 'translateY(10px)';
        requestAnimationFrame(() => {
          card.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        });
      }
    });

    // Show/hide empty state
    if (emptyState) {
      emptyState.style.display = visibleCount === 0 ? '' : 'none';
    }

    // Update URL without reload
    const newUrl = new URL(window.location);
    newUrl.searchParams.set('tab', currentTab);
    newUrl.searchParams.set('lang', currentLang);
    history.replaceState(null, '', newUrl);
  }

  // Tab click handlers
  document.querySelectorAll('#setsTabNav .sets-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      currentTab = btn.dataset.tab;
      updateTabUI(currentTab);
      filterSets();
    });
  });

  // Language click handlers
  document.querySelectorAll('#setsLangNav .sets-lang-pill').forEach(btn => {
    btn.addEventListener('click', () => {
      currentLang = btn.dataset.lang;
      updateLangUI(currentLang);
      filterSets();
    });
  });

  // Initialize filter state on load
  filterSets();
})();
</script>
{% endblock %}
