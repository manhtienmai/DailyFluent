{# templates/home.html #}
{% extends "layouts/sidebar_layout.html" %}
{% load static %}

{% block title %}DailyFluent - Trang ch·ªß{% endblock %}

{% block extra_css %}
<style>
  /* ========================================
     Dashboard - Theme Aware Styles
     ======================================== */

  .df-dashboard {
    padding: 1.5rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Hero Section */
  .df-hero {
    display: grid;
    grid-template-columns: 200px 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  @media (max-width: 900px) {
    .df-hero {
      grid-template-columns: 1fr 1fr;
    }
    .df-hero-avatar {
      display: none;
    }
  }

  @media (max-width: 640px) {
    .df-hero {
      grid-template-columns: 1fr;
    }
  }

  /* Avatar Card */
  .df-hero-avatar {
    position: relative;
    border-radius: 1.5rem;
    overflow: hidden;
    height: 200px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .df-hero-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .df-hero-avatar-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 5rem;
  }

  /* Stats Card - Modern Glassmorphism */
  .df-vocab-stats {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 1.5rem;
    padding: 1.25rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    height: 200px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 24px rgba(99, 102, 241, 0.1);
    position: relative;
    overflow: hidden;
  }
  
  .df-vocab-stats::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
    pointer-events: none;
  }

  .df-vocab-stat {
    text-align: center;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid rgba(255, 255, 255, 0.5);
  }
  
  [data-theme="dark"] .df-vocab-stat {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .df-vocab-stat:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
  }

  .df-vocab-stat-value {
    font-size: 1.75rem;
    font-weight: 800;
    line-height: 1.1;
    background: linear-gradient(135deg, #6366F1, #8B5CF6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .df-vocab-stat-value--primary {
    background: linear-gradient(135deg, #10B981, #34D399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .df-vocab-stat-value--secondary {
    background: linear-gradient(135deg, #F59E0B, #FBBF24);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .df-vocab-stat-value--accent {
    background: linear-gradient(135deg, #EC4899, #F472B6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .df-vocab-stat-label {
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-top: 0.375rem;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  /* Streak Card */
  .df-streak-card {
    background: linear-gradient(135deg, #F97316, #FBBF24);
    border-radius: 1.5rem;
    padding: 1rem;
    color: #fff;
    position: relative;
    overflow: hidden;
    height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .df-streak-title {
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    opacity: 0.9;
    margin-bottom: 0.25rem;
  }

  .df-streak-count {
    display: flex;
    align-items: baseline;
    gap: 0.375rem;
    margin-bottom: 0.75rem;
  }

  .df-streak-number {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1;
  }

  .df-streak-unit {
    font-size: 0.875rem;
    opacity: 0.9;
  }

  /* Week Days */
  .df-streak-days {
    display: flex;
    gap: 0.375rem;
    flex-wrap: wrap;
  }

  .df-streak-day {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6875rem;
    font-weight: 600;
    transition: all 0.2s;
  }

  .df-streak-day--inactive {
    background: rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.7);
  }

  .df-streak-day--active {
    background: #fff;
    color: #F97316;
  }

  .df-streak-day--today {
    background: #fff;
    color: #F97316;
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.4);
  }

  /* Quick Access */
  .df-quick-access {
    margin-bottom: 2rem;
  }

  .df-quick-access-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 1rem;
  }

  .df-quick-access-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .df-quick-access-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .df-quick-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 1rem;
    text-decoration: none;
    transition: all 0.2s;
  }

  .df-quick-card:hover {
    border-color: var(--action-primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .df-quick-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .df-quick-icon--blue { background: rgba(99, 102, 241, 0.15); }
  .df-quick-icon--yellow { background: rgba(245, 158, 11, 0.15); }
  .df-quick-icon--green { background: rgba(16, 185, 129, 0.15); }
  .df-quick-icon--red { background: rgba(239, 68, 68, 0.15); }

  .df-quick-text {
    flex: 1;
    min-width: 0;
  }

  .df-quick-label {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .df-quick-desc {
    font-size: 0.75rem;
    color: var(--text-tertiary);
  }

  .df-quick-arrow {
    color: var(--text-tertiary);
    transition: transform 0.2s;
  }

  .df-quick-card:hover .df-quick-arrow {
    transform: translateX(4px);
  }

  /* Section */
  .df-section {
    margin-bottom: 2rem;
  }

  .df-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .df-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
  }

  .df-section-link {
    font-size: 0.8125rem;
    color: var(--action-primary);
    text-decoration: none;
    font-weight: 500;
  }

  .df-section-link:hover {
    text-decoration: underline;
  }

  /* Course/Vocab Card */
  .df-item-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 1rem;
    text-decoration: none;
    transition: all 0.15s;
    margin-bottom: 0.75rem;
  }

  .df-item-card:hover {
    background: var(--bg-interactive);
    border-color: var(--action-primary);
  }

  .df-item-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .df-item-content {
    flex: 1;
    min-width: 0;
  }

  .df-item-title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.125rem;
  }

  .df-item-meta {
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  /* Two Column Grid */
  .df-grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .df-grid-2 {
      grid-template-columns: 1fr;
    }
  }

  .df-grid-section {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 1.25rem;
    padding: 1.25rem;
  }

  /* Mobile Specific Styles */
  @media (max-width: 640px) {
    .df-dashboard {
      padding: 1rem 0.75rem;
    }
    
    .df-hero {
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .df-vocab-stats {
      height: auto;
      padding: 0.75rem;
      gap: 0.375rem;
    }
    
    .df-vocab-stat {
      padding: 0.5rem 0.25rem;
    }
    
    .df-vocab-stat-value {
      font-size: 1.25rem;
    }
    
    .df-vocab-stat-label {
      font-size: 0.6875rem;
    }
    
    .df-streak-card {
      height: auto;
      padding: 1rem;
    }
    
    .df-streak-number {
      font-size: 2rem;
    }
    
    .df-streak-days {
      gap: 0.25rem;
    }
    
    .df-streak-day {
      width: 30px;
      height: 30px;
      font-size: 0.625rem;
    }
    
    .df-quick-access {
      margin-bottom: 1.5rem;
    }
    
    .df-quick-access-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
    
    .df-quick-card {
      padding: 0.75rem;
      gap: 0.75rem;
      border-radius: 0.875rem;
    }
    
    .df-quick-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      font-size: 1.125rem;
    }
    
    .df-quick-label {
      font-size: 0.8125rem;
    }
    
    .df-quick-desc {
      display: none;
    }
    
    .df-quick-arrow {
      display: none;
    }
    
    .df-grid-2 {
      gap: 1rem;
    }
    
    .df-grid-section {
      padding: 1rem;
      border-radius: 1rem;
    }
    
    .df-section-title {
      font-size: 1.0625rem;
    }
    
    .df-item-card {
      padding: 0.875rem;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    .df-item-icon {
      width: 40px;
      height: 40px;
      font-size: 1.25rem;
    }
    
    .df-item-title {
      font-size: 0.875rem;
    }
    
    .df-item-meta {
      font-size: 0.6875rem;
    }
  }
  
  @media (max-width: 480px) {
    .df-quick-access-grid {
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }
    
    .df-quick-card {
      flex-direction: column;
      text-align: center;
      padding: 0.875rem 0.5rem;
    }
    
    .df-quick-text {
      width: 100%;
    }
    
    .df-quick-label {
      font-size: 0.75rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="df-dashboard">
  {% if user.is_authenticated %}

  <!-- Hero Section: Avatar + Vocab Stats + Streak -->
  <div class="df-hero">
    <!-- Avatar -->
    <div class="df-hero-avatar">
      {% if user.profile.avatar %}
        <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}">
      {% else %}
        <div class="df-hero-avatar-placeholder">üëã</div>
      {% endif %}
    </div>

    <!-- Vocabulary Stats -->
    <div class="df-vocab-stats">
      <a href="{% url 'vocab:my_words' %}?filter=mastered" class="df-vocab-stat" style="text-decoration: none;">
        <div class="df-vocab-stat-value df-vocab-stat-value--primary">{{ vocab_stats.mastered|default:0 }}</div>
        <div class="df-vocab-stat-label">ƒê√£ thu·ªôc</div>
      </a>
      <a href="{% url 'vocab:my_words' %}?filter=learning" class="df-vocab-stat" style="text-decoration: none;">
        <div class="df-vocab-stat-value df-vocab-stat-value--secondary">{{ vocab_stats.learning|default:0 }}</div>
        <div class="df-vocab-stat-label">Ch∆∞a thu·ªôc</div>
      </a>
      <a href="{% url 'vocab:my_words' %}?filter=all" class="df-vocab-stat" style="text-decoration: none;">
        <div class="df-vocab-stat-value df-vocab-stat-value--primary">{{ vocab_stats.total|default:0 }}</div>
        <div class="df-vocab-stat-label">T·ªïng t·ª´</div>
      </a>
      <div class="df-vocab-stat">
        <div class="df-vocab-stat-value df-vocab-stat-value--accent">{{ vocab_stats.progress|default:"0%" }}</div>
        <div class="df-vocab-stat-label">Ti·∫øn ƒë·ªô</div>
      </div>
    </div>

    <!-- Streak Card -->
    <div class="df-streak-card">
      <div class="df-streak-title">üî• Chu·ªói ng√†y h·ªçc</div>
      <div class="df-streak-count">
        <span class="df-streak-number" id="streak-number" data-streak="{{ streak.current_streak|default:0 }}">{{ streak.current_streak|default:0 }}</span>
        <span class="df-streak-unit">ng√†y</span>
      </div>
      <div class="df-streak-days">
        {% for day in week_days %}
        <div class="df-streak-day {% if day.is_today %}df-streak-day--today{% elif day.studied %}df-streak-day--active{% else %}df-streak-day--inactive{% endif %}">
          {{ day.label }}
        </div>
        {% empty %}
        <div class="df-streak-day df-streak-day--inactive">T6</div>
        <div class="df-streak-day df-streak-day--inactive">T7</div>
        <div class="df-streak-day df-streak-day--inactive">CN</div>
        <div class="df-streak-day df-streak-day--inactive">T2</div>
        <div class="df-streak-day df-streak-day--inactive">T3</div>
        <div class="df-streak-day df-streak-day--today">T4</div>
        <div class="df-streak-day df-streak-day--inactive">T5</div>
        {% endfor %}
      </div>
    </div>
  </div>

  </div>

  <!-- Placement Dashboard Integration -->
  {% if user.is_authenticated %}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Daily Lesson -->
        {% if lesson %}
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    üìã B√†i h·ªçc h√¥m nay
                </h2>
                <span class="text-sm text-slate-500 font-medium">{{ lesson.target_minutes }} ph√∫t</span>
            </div>
            
            {% if lesson.recommended_activities %}
            <div class="space-y-3">
                {% for activity in lesson.recommended_activities|slice:":2" %}
                <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-xl border border-slate-100 dark:border-slate-600">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0
                                {% if activity.type == 'vocab_review' %}bg-blue-100 text-blue-600
                                {% elif activity.type == 'skill_practice' %}bg-orange-100 text-orange-600
                                {% elif activity.type == 'path_vocab' %}bg-green-100 text-green-600
                                {% else %}bg-gray-100 text-gray-600{% endif %}">
                        {% if activity.type == 'vocab_review' %}üìö
                        {% elif activity.type == 'skill_practice' %}üéØ
                        {% else %}üìù{% endif %}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-slate-900 dark:text-white truncate">{{ activity.reason }}</p>
                        <p class="text-xs text-slate-500">{{ activity.estimated_minutes|floatformat:0 }} ph√∫t</p>
                    </div>
                    <a href="{% if activity.type == 'vocab_review' %}{% url 'vocab:flashcards_english' %}{% else %}#{% endif %}"
                       class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold rounded-lg transition-colors">
                        B·∫Øt ƒë·∫ßu
                    </a>
                </div>
                {% endfor %}
                {% if lesson.recommended_activities|length > 2 %}
                 <div class="text-center mt-2">
                    <a href="{% url 'placement:daily_dashboard' %}" class="text-sm text-indigo-600 font-medium hover:underline">
                        + {{ lesson.recommended_activities|length|add:"-2" }} ho·∫°t ƒë·ªông kh√°c
                    </a>
                 </div>
                {% endif %}
            </div>
            {% else %}
            <p class="text-slate-500 text-center py-4 text-sm">B·∫°n ƒë√£ ho√†n th√†nh b√†i h·ªçc h√¥m nay!</p>
            {% endif %}

            <!-- Simple Progress -->
            {% if lesson.actual_minutes > 0 %}
            <div class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700">
                <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-500">Ti·∫øn ƒë·ªô</span>
                    <span class="font-bold text-indigo-600">{{ lesson.actual_minutes }}/{{ lesson.target_minutes }}m</span>
                </div>
                <div class="h-1.5 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
                    {% widthratio lesson.actual_minutes lesson.target_minutes 100 as progress %}
                    <div class="h-full bg-indigo-500 rounded-full" style="width: {{ progress }}%"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Path Status / CTA -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 flex flex-col justify-center">
            {% if path %}
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        üõ§Ô∏è L·ªô tr√¨nh h·ªçc
                    </h2>
                    <a href="{% url 'placement:learning_path' %}" class="text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded-lg">
                        Chi ti·∫øt
                    </a>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between items-end mb-2">
                        <div>
                            <p class="text-sm text-slate-500">M·ª•c ti√™u</p>
                            <p class="text-xl font-bold text-slate-900 dark:text-white">{{ path.target_score }} TOEIC</p>
                        </div>
                        <div class="text-right">
                             <p class="text-sm text-slate-500">Ho√†n th√†nh</p>
                             <p class="text-xl font-bold text-indigo-600">{{ path.progress_percentage|floatformat:0 }}%</p>
                        </div>
                    </div>
                    <div class="h-2.5 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full transition-all duration-1000" 
                             style="width: {{ path.progress_percentage }}%"></div>
                    </div>
                </div>
                
                <div class="bg-slate-50 dark:bg-slate-700/30 rounded-xl p-3">
                    <p class="text-xs text-slate-500 mb-2 font-medium uppercase tracking-wide">Milestone ti·∫øp theo</p>
                    {% for m in path.milestones.all %}
                        {% if m.is_unlocked and not m.is_completed %}
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center font-bold text-xs">
                                {{ m.order }}
                            </div>
                            <span class="text-sm font-medium text-slate-900 dark:text-white line-clamp-1">{{ m.title }}</span>
                        </div>
                        <!-- Break after finding first active milestone -->
                        {% endif %}
                    {% endfor %}
                </div>

            {% else %}
                <!-- No Path CTA -->
                <div class="text-center py-2">
                    <div class="w-16 h-16 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl">
                        üöÄ
                    </div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-1">Ch∆∞a c√≥ l·ªô tr√¨nh?</h3>
                    <p class="text-sm text-slate-500 mb-4 px-4">L√†m b√†i test ƒë√°nh gi√° nƒÉng l·ª±c ƒë·ªÉ nh·∫≠n l·ªô tr√¨nh c√° nh√¢n h√≥a.</p>
                    <a href="{% url 'placement:welcome' %}" 
                       class="inline-block px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-indigo-200 dark:shadow-none">
                        L√†m b√†i test ngay
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
  {% endif %}

  <!-- Quick Access -->
  <div class="df-quick-access">
    <div class="df-quick-access-title">Truy c·∫≠p nhanh</div>
    <div class="df-quick-access-grid">
      <a href="{% url 'vocab:english_list' %}" class="df-quick-card">
        <div class="df-quick-icon df-quick-icon--blue">‚ûï</div>
        <div class="df-quick-text">
          <div class="df-quick-label">Th√™m t·ª´ m·ªõi</div>
          <div class="df-quick-desc">T·∫°o t·ª´ v·ª±ng c√° nh√¢n</div>
        </div>
        <svg class="df-quick-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>

      <a href="{% url 'vocab:games' %}" class="df-quick-card">
        <div class="df-quick-icon df-quick-icon--yellow">‚ö°</div>
        <div class="df-quick-text">
          <div class="df-quick-label">Luy·ªán t·∫≠p</div>
          <div class="df-quick-desc">Flashcard & Games</div>
        </div>
        <svg class="df-quick-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>

      <a href="{% url 'core:course_list' %}" class="df-quick-card">
        <div class="df-quick-icon df-quick-icon--green">üèõÔ∏è</div>
        <div class="df-quick-text">
          <div class="df-quick-label">L·ªô tr√¨nh h·ªçc</div>
          <div class="df-quick-desc">H·ªçc theo ch·ªß ƒë·ªÅ</div>
        </div>
        <svg class="df-quick-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>

      <a href="{% url 'core:profile' %}" class="df-quick-card">
        <div class="df-quick-icon df-quick-icon--red">üèÜ</div>
        <div class="df-quick-text">
          <div class="df-quick-label">X·∫øp h·∫°ng</div>
          <div class="df-quick-desc">Xem th√†nh t√≠ch</div>
        </div>
        <svg class="df-quick-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>
    </div>
  </div>

  <!-- Courses + Exam Results -->
  <div class="df-grid-2 df-section">
    <!-- My Courses -->
    <div class="df-grid-section">
      <div class="df-section-header">
        <h2 class="df-section-title">üìö Kh√≥a h·ªçc c·ªßa t√¥i</h2>
        <a href="{% url 'core:course_list' %}" class="df-section-link">Xem t·∫•t c·∫£ ‚Üí</a>
      </div>
      {% if enrolled_courses %}
        {% for enrollment in enrolled_courses %}
        <a href="{% url 'core:course_detail' enrollment.course.slug %}" class="df-item-card">
          <div class="df-item-icon" style="background: linear-gradient(135deg, #6366F1, #8B5CF6); color: #fff;">
            {{ enrollment.course.title|slice:":2"|upper }}
          </div>
          <div class="df-item-content">
            <div class="df-item-title">{{ enrollment.course.title }}</div>
            <div class="df-item-meta">{% if enrollment.progress %}{{ enrollment.progress }}% ho√†n th√†nh{% else %}Ch∆∞a b·∫Øt ƒë·∫ßu{% endif %}</div>
          </div>
        </a>
        {% endfor %}
      {% else %}
        <p style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
          B·∫°n ch∆∞a ƒëƒÉng k√Ω kh√≥a h·ªçc n√†o.<br>
          <a href="{% url 'core:course_list' %}" style="color: var(--action-primary);">Kh√°m ph√° kh√≥a h·ªçc ‚Üí</a>
        </p>
      {% endif %}
    </div>

    <!-- Exam Results -->
    <div class="df-grid-section">
      <div class="df-section-header">
        <h2 class="df-section-title">üìä K·∫øt qu·∫£ luy·ªán thi</h2>
        <a href="{% url 'core:profile' %}" class="df-section-link">Xem t·∫•t c·∫£ ‚Üí</a>
      </div>
      {% if recent_exam_results %}
        {% for result in recent_exam_results|slice:":3" %}
        <a href="{% url 'exam:exam_result' result.id %}" class="df-item-card">
          <div class="df-item-icon" style="{% if result.score >= 80 %}background: rgba(16, 185, 129, 0.15); color: #059669;{% elif result.score >= 60 %}background: rgba(245, 158, 11, 0.15); color: #D97706;{% else %}background: rgba(239, 68, 68, 0.15); color: #DC2626;{% endif %}">
            {{ result.score|floatformat:0 }}%
          </div>
          <div class="df-item-content">
            <div class="df-item-title">{{ result.template.title }}</div>
            <div class="df-item-meta">{{ result.submitted_at|date:"d/m/Y" }} ‚Ä¢ {{ result.correct_count }}/{{ result.total_questions }} c√¢u ƒë√∫ng</div>
          </div>
        </a>
        {% endfor %}
      {% else %}
        <p style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
          B·∫°n ch∆∞a l√†m b√†i thi n√†o.<br>
          <a href="{% url 'exam:exam_list' %}" style="color: var(--action-primary);">L√†m b√†i thi ngay ‚Üí</a>
        </p>
      {% endif %}
    </div>
  </div>

  <!-- Latest Exams Section -->
  {% if latest_exams %}
  <div class="df-section">
    <div class="df-section-header">
      <h2 class="df-section-title">üìù ƒê·ªÅ thi m·ªõi nh·∫•t</h2>
      <a href="{% url 'exam:exam_list' %}" class="df-section-link">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
      {% for exam in latest_exams|slice:":8" %}
      <a href="{% url 'exam:exam_detail' exam.slug %}" class="df-item-card" style="flex-direction: column; text-align: center;">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÑ</div>
        <div class="df-item-title" style="font-size: 0.8125rem; line-height: 1.3;">{{ exam.title|truncatechars:40 }}</div>
        <div class="df-item-meta">{{ exam.total_questions }} c√¢u ‚Ä¢ {{ exam.attempt_count|default:0 }} l∆∞·ª£t</div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  {% else %}
  <!-- Non-authenticated user landing -->
  <div style="text-align: center; margin-bottom: 2rem;">
    <h1 style="font-size: 2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">
      üìö Kho ƒë·ªÅ thi TOEIC & JLPT
    </h1>
    <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
      Luy·ªán thi mi·ªÖn ph√≠ v·ªõi h√†ng ng√†n c√¢u h·ªèi th·ª±c t·∫ø
    </p>
    <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;">
      <a href="{% url 'account_login' %}" style="padding: 0.75rem 1.5rem; background: var(--action-primary); color: var(--action-primary-text); border-radius: 0.75rem; text-decoration: none; font-weight: 600;">
        ƒêƒÉng nh·∫≠p
      </a>
      <a href="{% url 'account_signup' %}" style="padding: 0.75rem 1.5rem; background: var(--bg-surface); color: var(--text-primary); border: 1px solid var(--border-default); border-radius: 0.75rem; text-decoration: none; font-weight: 600;">
        ƒêƒÉng k√Ω
      </a>
    </div>
  </div>

  <!-- Exam Grid (same UI as exam_list.html) -->
  {% if latest_exams %}
  <style>
    .df-guest-exam-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.25rem;
    }
    .df-guest-exam-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }
    .df-guest-exam-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--action-primary) 0%, var(--action-accent) 100%);
      opacity: 0;
      transition: opacity 0.25s;
    }
    .df-guest-exam-card:hover {
      border-color: var(--card-hover-border);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
    .df-guest-exam-card:hover::before { opacity: 1; }
    .df-guest-exam-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
      line-height: 1.4;
    }
    .df-guest-exam-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }
    .df-guest-exam-card-level {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.625rem;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-radius: 0.375rem;
    }
    .df-guest-exam-card-level--toeic {
      background: rgba(245, 158, 11, 0.15);
      color: #D97706;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    .df-guest-exam-card-level--n5 { background: rgba(59, 130, 246, 0.15); color: #2563EB; border: 1px solid rgba(59, 130, 246, 0.3); }
    .df-guest-exam-card-level--n4 { background: rgba(16, 185, 129, 0.15); color: #059669; border: 1px solid rgba(16, 185, 129, 0.3); }
    .df-guest-exam-card-level--n3 { background: rgba(249, 115, 22, 0.15); color: #EA580C; border: 1px solid rgba(249, 115, 22, 0.3); }
    .df-guest-exam-card-level--n2 { background: rgba(236, 72, 153, 0.15); color: #DB2777; border: 1px solid rgba(236, 72, 153, 0.3); }
    .df-guest-exam-card-level--n1 { background: rgba(139, 92, 246, 0.15); color: #7C3AED; border: 1px solid rgba(139, 92, 246, 0.3); }
    .df-guest-exam-card-users {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }
    .df-guest-exam-card-users svg { width: 14px; height: 14px; }
    .df-guest-exam-card-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }
    .df-guest-exam-card-meta-item { display: flex; align-items: center; gap: 0.375rem; }
    .df-guest-exam-card-meta-item svg { width: 14px; height: 14px; opacity: 0.7; }
    .df-guest-exam-card-footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-top: 1rem;
      border-top: 1px solid var(--border-subtle);
    }
    .df-guest-exam-card-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1.25rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--action-primary-text);
      background: var(--action-primary);
      border-radius: 0.5rem;
      text-decoration: none;
      transition: all 0.2s;
    }
    .df-guest-exam-card-btn:hover {
      background: var(--action-primary-hover);
      transform: translateX(2px);
      box-shadow: var(--shadow-primary);
    }
    .df-guest-exam-card-btn svg { width: 16px; height: 16px; transition: transform 0.2s; }
    .df-guest-exam-card-btn:hover svg { transform: translateX(2px); }
    @media (max-width: 640px) {
      .df-guest-exam-grid { grid-template-columns: 1fr; }
    }
  </style>
  <div class="df-guest-exam-grid">
    {% for exam in latest_exams %}
    <div class="df-guest-exam-card">
      <h2 class="df-guest-exam-card-title">{{ exam.title }}</h2>
      <div class="df-guest-exam-card-header">
        <span class="df-guest-exam-card-level df-guest-exam-card-level--{{ exam.level|lower }}">
          {{ exam.level }}
        </span>
        <span class="df-guest-exam-card-users">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          {{ exam.attempt_count|default:0 }} l∆∞·ª£t l√†m
        </span>
      </div>
      <div class="df-guest-exam-card-meta">
        <span class="df-guest-exam-card-meta-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          {{ exam.questions.count }} c√¢u
        </span>
        <span class="df-guest-exam-card-meta-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          {{ exam.duration_minutes }} ph√∫t
        </span>
      </div>
      <div class="df-guest-exam-card-footer">
        <a href="{% url 'exam:exam_detail' exam.slug %}" class="df-guest-exam-card-btn">
          Chi ti·∫øt
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
  <div style="text-align: center; margin-top: 1.5rem;">
    <a href="{% url 'exam:exam_list' %}" style="color: var(--action-primary); font-weight: 600; text-decoration: none;">
      Xem t·∫•t c·∫£ ƒë·ªÅ thi ‚Üí
    </a>
  </div>
  {% endif %}
  {% endif %}
</div>

{% if user.is_authenticated and streak and streak.current_streak > 0 %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const el = document.getElementById('streak-number');
  if (!el) return;
  const target = parseInt(el.dataset.streak, 10) || 0;
  let current = 0;
  const duration = 600;
  const start = performance.now();

  function animate(now) {
    const progress = Math.min((now - start) / duration, 1);
    current = Math.round(progress * target);
    el.textContent = current;
    if (progress < 1) requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
});
</script>
{% endif %}

{% if not user.is_authenticated %}
{% include "components/landing/why_choose_us.html" %}
{% include "components/landing/student_stories.html" %}
{% endif %}
{% endblock %}