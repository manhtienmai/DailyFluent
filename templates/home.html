{# templates/home.html - Frosted Crystal Dashboard #}
{% extends "layouts/sidebar_layout.html" %}
{% load static %}

{% block title %}DailyFluent - Trang ch·ªß{% endblock %}

{% block extra_css %}
<style>
  /* =============================================
     Home Dashboard - Frosted Crystal Design
     ============================================= */

  /* Pastel Gradient Mesh Background */
  .crystal-dashboard {
    min-height: 100vh;
    background:
      radial-gradient(ellipse 80% 50% at 10% 20%, rgba(199, 210, 254, 0.5) 0%, transparent 50%),
      radial-gradient(ellipse 60% 50% at 90% 80%, rgba(251, 207, 232, 0.4) 0%, transparent 50%),
      radial-gradient(ellipse 50% 40% at 50% 10%, rgba(254, 215, 170, 0.35) 0%, transparent 45%),
      radial-gradient(ellipse 40% 50% at 80% 30%, rgba(167, 243, 208, 0.25) 0%, transparent 40%),
      linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
    background-attachment: fixed;
    padding: 1.25rem;
  }

  [data-theme="dark"] .crystal-dashboard {
    background:
      radial-gradient(ellipse 80% 50% at 10% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
      radial-gradient(ellipse 60% 50% at 90% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
      radial-gradient(ellipse 50% 40% at 50% 10%, rgba(245, 158, 11, 0.1) 0%, transparent 45%),
      linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
    background-attachment: fixed;
  }

  .dashboard-container {
    max-width: 900px;
    margin: 0 auto;
  }

  /* ========== GLASS PANELS ========== */
  .glass-panel {
    background: rgba(255, 255, 255, 0.72);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.8);
    border-radius: 20px;
    box-shadow:
      0 4px 24px -4px rgba(99, 102, 241, 0.1),
      0 8px 48px -8px rgba(99, 102, 241, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }

  [data-theme="dark"] .glass-panel {
    background: rgba(30, 41, 59, 0.75);
    border-color: rgba(148, 163, 184, 0.1);
    box-shadow:
      0 4px 24px -4px rgba(0, 0, 0, 0.35),
      0 8px 48px -8px rgba(0, 0, 0, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .glass-panel-light {
    background: rgba(255, 255, 255, 0.55);
    backdrop-filter: blur(14px) saturate(150%);
    -webkit-backdrop-filter: blur(14px) saturate(150%);
    border: 1px solid rgba(255, 255, 255, 0.65);
    border-radius: 16px;
    box-shadow:
      0 2px 12px -2px rgba(99, 102, 241, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.75);
  }

  [data-theme="dark"] .glass-panel-light {
    background: rgba(30, 41, 59, 0.55);
    border-color: rgba(148, 163, 184, 0.08);
  }

  /* ========== UNIFIED DASHBOARD HEADER ========== */
  .dash-header {
    padding: 1.25rem;
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
  }

  .dash-header::before {
    content: '';
    position: absolute;
    top: -40%;
    right: -15%;
    width: 260px;
    height: 260px;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.12) 0%, transparent 65%);
    pointer-events: none;
  }

  /* Top row: Greeting + Streak */
  .dash-top-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
  }

  .dash-greeting {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .dash-wave {
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.375rem;
    box-shadow: 0 4px 12px -4px rgba(99, 102, 241, 0.5);
    flex-shrink: 0;
  }

  .dash-greeting-text h1 {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1e293b;
    letter-spacing: -0.01em;
    margin: 0;
  }

  [data-theme="dark"] .dash-greeting-text h1 {
    color: #f1f5f9;
  }

  .dash-greeting-sub {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.125rem;
  }

  [data-theme="dark"] .dash-greeting-sub {
    color: #94a3b8;
  }

  /* Streak Capsule */
  .dash-streak {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 0.625rem 1rem;
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.12) 0%, rgba(245, 158, 11, 0.08) 100%);
    border: 1px solid rgba(249, 115, 22, 0.18);
    border-radius: 14px;
    flex-shrink: 0;
  }

  [data-theme="dark"] .dash-streak {
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
    border-color: rgba(249, 115, 22, 0.2);
  }

  .dash-streak-num {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .dash-streak-fire {
    font-size: 1.25rem;
    animation: fireGlow 1.5s ease-in-out infinite;
  }

  @keyframes fireGlow {
    0%, 100% { filter: drop-shadow(0 0 3px rgba(255, 180, 80, 0.5)); transform: scale(1); }
    50% { filter: drop-shadow(0 0 10px rgba(255, 180, 80, 0.8)); transform: scale(1.1); }
  }

  .dash-streak-value {
    font-size: 1.5rem;
    font-weight: 800;
    line-height: 1;
    letter-spacing: -0.03em;
    background: linear-gradient(135deg, #ea580c 0%, #f59e0b 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .dash-streak-unit {
    font-size: 0.6875rem;
    font-weight: 600;
    color: #c2410c;
    margin-left: -0.125rem;
  }

  [data-theme="dark"] .dash-streak-unit {
    color: #fb923c;
  }

  .dash-streak-days {
    display: flex;
    gap: 0.25rem;
  }

  .dash-streak-dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.5625rem;
    font-weight: 700;
    transition: all 0.2s ease;
  }

  .dash-streak-dot--off {
    background: rgba(249, 115, 22, 0.1);
    color: #c2410c;
    opacity: 0.5;
  }

  [data-theme="dark"] .dash-streak-dot--off {
    background: rgba(249, 115, 22, 0.1);
    color: #fb923c;
  }

  .dash-streak-dot--on {
    background: linear-gradient(135deg, #f97316 0%, #f59e0b 100%);
    color: white;
    box-shadow: 0 2px 6px -2px rgba(249, 115, 22, 0.5);
  }

  .dash-streak-dot--today {
    background: linear-gradient(135deg, #f97316 0%, #f59e0b 100%);
    color: white;
    box-shadow: 0 0 0 2.5px rgba(249, 115, 22, 0.25), 0 2px 6px -2px rgba(249, 115, 22, 0.5);
  }

  /* Divider */
  .dash-divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.2), transparent);
    margin-bottom: 1rem;
  }

  [data-theme="dark"] .dash-divider {
    background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.1), transparent);
  }

  /* Stats Row */
  .dash-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
    position: relative;
    z-index: 1;
  }

  .dash-stat {
    text-align: center;
    padding: 0.75rem 0.5rem;
    background: rgba(255, 255, 255, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.65);
    border-radius: 12px;
    transition: all 0.2s ease;
    text-decoration: none;
    display: block;
  }

  [data-theme="dark"] .dash-stat {
    background: rgba(51, 65, 85, 0.45);
    border-color: rgba(148, 163, 184, 0.08);
  }

  .dash-stat:hover {
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.85);
    box-shadow: 0 4px 12px -4px rgba(99, 102, 241, 0.15);
  }

  [data-theme="dark"] .dash-stat:hover {
    background: rgba(99, 102, 241, 0.12);
  }

  .dash-stat-value {
    font-size: 1.5rem;
    font-weight: 800;
    line-height: 1.2;
    letter-spacing: -0.03em;
  }

  .dash-stat-value--green {
    background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .dash-stat-value--amber {
    background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .dash-stat-value--indigo {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .dash-stat-value--rose {
    background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .dash-stat-label {
    font-size: 0.625rem;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    margin-top: 0.25rem;
  }

  [data-theme="dark"] .dash-stat-label {
    color: #94a3b8;
  }

  /* ========== TODAY'S MISSION ========== */
  .mission-section {
    margin-bottom: 1rem;
  }

  .section-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.6875rem;
    font-weight: 700;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.75rem;
    padding-left: 0.25rem;
  }

  [data-theme="dark"] .section-label {
    color: #94a3b8;
  }

  .section-label svg {
    width: 14px;
    height: 14px;
  }

  .mission-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .mission-item {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 0.875rem 1rem;
    background: rgba(255, 255, 255, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 14px;
    transition: all 0.2s ease;
    text-decoration: none;
    backdrop-filter: blur(10px);
  }

  [data-theme="dark"] .mission-item {
    background: rgba(51, 65, 85, 0.4);
    border-color: rgba(148, 163, 184, 0.1);
  }

  .mission-item:hover {
    background: rgba(255, 255, 255, 0.85);
    transform: translateX(4px);
    box-shadow: 0 4px 16px -4px rgba(99, 102, 241, 0.15);
  }

  [data-theme="dark"] .mission-item:hover {
    background: rgba(99, 102, 241, 0.12);
  }

  .mission-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .mission-icon--review {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
    box-shadow: 0 4px 12px -4px rgba(59, 130, 246, 0.5);
  }

  .mission-icon--milestone {
    background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    box-shadow: 0 4px 12px -4px rgba(16, 185, 129, 0.5);
  }

  .mission-icon svg {
    width: 20px;
    height: 20px;
    color: white;
  }

  .mission-content {
    flex: 1;
    min-width: 0;
  }

  .mission-title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.125rem;
  }

  [data-theme="dark"] .mission-title {
    color: #f1f5f9;
  }

  .mission-meta {
    font-size: 0.75rem;
    color: #64748b;
  }

  [data-theme="dark"] .mission-meta {
    color: #94a3b8;
  }

  .mission-btn {
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px -2px rgba(99, 102, 241, 0.5);
  }

  .mission-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px -4px rgba(99, 102, 241, 0.6);
  }

  .mission-btn--pulse {
    animation: pulse-btn 2s ease-in-out infinite;
  }

  @keyframes pulse-btn {
    0%, 100% { box-shadow: 0 2px 8px -2px rgba(99, 102, 241, 0.5); }
    50% { box-shadow: 0 4px 16px -4px rgba(99, 102, 241, 0.7); }
  }

  .mission-arrow {
    width: 18px;
    height: 18px;
    color: #94a3b8;
    transition: transform 0.2s ease;
  }

  .mission-item:hover .mission-arrow {
    transform: translateX(4px);
    color: #6366f1;
  }

  /* ========== QUICK ACTIONS ========== */
  .quick-actions {
    margin-bottom: 1rem;
  }

  .quick-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
  }

  @media (max-width: 640px) {
    .quick-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .quick-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    padding: 1rem 0.75rem;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .quick-btn:hover {
    transform: translateY(-3px);
    background: rgba(255, 255, 255, 0.85);
    box-shadow:
      0 8px 24px -8px rgba(99, 102, 241, 0.18),
      inset 0 1px 0 rgba(255, 255, 255, 0.95);
  }

  [data-theme="dark"] .quick-btn:hover {
    background: rgba(99, 102, 241, 0.12);
  }

  .quick-icon {
    width: 44px;
    height: 44px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    transition: transform 0.2s ease;
  }

  .quick-btn:hover .quick-icon {
    transform: scale(1.1);
  }

  .quick-icon--blue {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
    box-shadow: 0 4px 12px -4px rgba(59, 130, 246, 0.5);
  }

  .quick-icon--amber {
    background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
    box-shadow: 0 4px 12px -4px rgba(245, 158, 11, 0.5);
  }

  .quick-icon--green {
    background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    box-shadow: 0 4px 12px -4px rgba(16, 185, 129, 0.5);
  }

  .quick-icon--rose {
    background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
    box-shadow: 0 4px 12px -4px rgba(236, 72, 153, 0.5);
  }

  .quick-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #475569;
    text-align: center;
  }

  [data-theme="dark"] .quick-label {
    color: #cbd5e1;
  }

  /* ========== CONTENT GRID ========== */
  .content-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  @media (max-width: 768px) {
    .content-grid {
      grid-template-columns: 1fr;
    }
  }

  .content-panel {
    padding: 1rem;
  }

  .panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.875rem;
  }

  .panel-title {
    font-size: 0.875rem;
    font-weight: 700;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  [data-theme="dark"] .panel-title {
    color: #f1f5f9;
  }

  .panel-link {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6366f1;
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .panel-link:hover {
    color: #4f46e5;
  }

  [data-theme="dark"] .panel-link {
    color: #a5b4fc;
  }

  /* Course Ticket */
  .course-ticket {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 0.875rem;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
    border: 1px solid rgba(99, 102, 241, 0.15);
    border-radius: 14px;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-bottom: 0.5rem;
  }

  .course-ticket:last-child {
    margin-bottom: 0;
  }

  .course-ticket:hover {
    background: rgba(99, 102, 241, 0.12);
    border-color: rgba(99, 102, 241, 0.25);
    transform: translateX(4px);
  }

  [data-theme="dark"] .course-ticket {
    background: rgba(99, 102, 241, 0.1);
    border-color: rgba(99, 102, 241, 0.2);
  }

  .course-icon {
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 800;
    font-size: 0.875rem;
    flex-shrink: 0;
    box-shadow: 0 4px 12px -4px rgba(99, 102, 241, 0.5);
  }

  .course-info {
    flex: 1;
    min-width: 0;
  }

  .course-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.125rem;
  }

  [data-theme="dark"] .course-title {
    color: #f1f5f9;
  }

  .course-meta {
    font-size: 0.75rem;
    color: #64748b;
  }

  [data-theme="dark"] .course-meta {
    color: #94a3b8;
  }

  .course-arrow {
    width: 16px;
    height: 16px;
    color: #94a3b8;
  }

  .course-ticket:hover .course-arrow {
    color: #6366f1;
  }

  /* Exam Result Item */
  .exam-result {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-bottom: 0.375rem;
  }

  .exam-result:last-child {
    margin-bottom: 0;
  }

  .exam-result:hover {
    background: rgba(99, 102, 241, 0.06);
  }

  [data-theme="dark"] .exam-result:hover {
    background: rgba(99, 102, 241, 0.1);
  }

  .exam-score {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8125rem;
    font-weight: 800;
    flex-shrink: 0;
  }

  .exam-score--high {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(52, 211, 153, 0.15) 100%);
    color: #059669;
    border: 1px solid rgba(16, 185, 129, 0.25);
  }

  .exam-score--medium {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(251, 191, 36, 0.15) 100%);
    color: #d97706;
    border: 1px solid rgba(245, 158, 11, 0.25);
  }

  .exam-score--low {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(248, 113, 113, 0.15) 100%);
    color: #dc2626;
    border: 1px solid rgba(239, 68, 68, 0.25);
  }

  .exam-info {
    flex: 1;
    min-width: 0;
  }

  .exam-title {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #1e293b;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  [data-theme="dark"] .exam-title {
    color: #f1f5f9;
  }

  .exam-meta {
    font-size: 0.6875rem;
    color: #64748b;
  }

  [data-theme="dark"] .exam-meta {
    color: #94a3b8;
  }

  /* ========== NEW EXAMS SCROLL ========== */
  .exams-section {
    margin-bottom: 1rem;
  }

  .exams-scroll {
    display: flex;
    gap: 0.75rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .exams-scroll::-webkit-scrollbar {
    display: none;
  }

  .exam-card {
    flex: 0 0 160px;
    padding: 1rem;
    text-decoration: none;
    text-align: center;
    transition: all 0.2s ease;
  }

  .exam-card:hover {
    transform: translateY(-3px);
    background: rgba(255, 255, 255, 0.85);
  }

  [data-theme="dark"] .exam-card:hover {
    background: rgba(99, 102, 241, 0.12);
  }

  .exam-card-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .exam-card-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: #1e293b;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  [data-theme="dark"] .exam-card-title {
    color: #f1f5f9;
  }

  .exam-card-meta {
    font-size: 0.625rem;
    color: #64748b;
    margin-top: 0.25rem;
  }

  [data-theme="dark"] .exam-card-meta {
    color: #94a3b8;
  }

  /* ========== EMPTY STATE ========== */
  .empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: #64748b;
  }

  [data-theme="dark"] .empty-state {
    color: #94a3b8;
  }

  .empty-state a {
    color: #6366f1;
    font-weight: 600;
    text-decoration: none;
  }

  .empty-state a:hover {
    text-decoration: underline;
  }

  /* ========== GUEST LANDING ========== */
  .guest-hero {
    text-align: center;
    padding: 2.5rem 1.5rem;
    margin-bottom: 1.5rem;
  }

  .guest-title {
    font-size: 1.75rem;
    font-weight: 800;
    color: #1e293b;
    letter-spacing: -0.02em;
    margin-bottom: 0.5rem;
  }

  [data-theme="dark"] .guest-title {
    color: #f1f5f9;
  }

  .guest-desc {
    font-size: 1rem;
    color: #64748b;
    margin-bottom: 1.5rem;
  }

  [data-theme="dark"] .guest-desc {
    color: #94a3b8;
  }

  .guest-actions {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .guest-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    font-size: 0.9375rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .guest-btn--primary {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    box-shadow: 0 4px 16px -4px rgba(99, 102, 241, 0.5);
  }

  .guest-btn--primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px -8px rgba(99, 102, 241, 0.6);
  }

  .guest-btn--secondary {
    background: rgba(255, 255, 255, 0.7);
    color: #475569;
    border: 1px solid rgba(148, 163, 184, 0.3);
  }

  .guest-btn--secondary:hover {
    background: rgba(255, 255, 255, 0.9);
    border-color: rgba(99, 102, 241, 0.3);
  }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 768px) {
    .dash-top-row {
      flex-direction: column;
      gap: 0.75rem;
    }

    .dash-streak {
      width: 100%;
      justify-content: center;
    }
  }

  @media (max-width: 640px) {
    .crystal-dashboard {
      padding: 1rem;
    }

    .dash-header {
      padding: 1rem;
    }

    .dash-stats {
      grid-template-columns: repeat(2, 1fr);
    }

    .dash-stat-value {
      font-size: 1.25rem;
    }

    .dash-streak-dot {
      width: 26px;
      height: 26px;
      font-size: 0.5rem;
    }

    .dash-streak-value {
      font-size: 1.25rem;
    }

    .quick-btn {
      padding: 0.875rem 0.5rem;
    }

    .quick-icon {
      width: 40px;
      height: 40px;
    }

    .quick-label {
      font-size: 0.6875rem;
    }
  }

  @media (max-width: 400px) {
    .dash-streak-days {
      gap: 0.1875rem;
    }

    .dash-streak-dot {
      width: 24px;
      height: 24px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="crystal-dashboard">
  <div class="dashboard-container">

    {% if user.is_authenticated %}

    <!-- ========== DASHBOARD HEADER ========== -->
    <header class="glass-panel dash-header">
      <!-- Top: Greeting + Streak -->
      <div class="dash-top-row">
        <div class="dash-greeting">
          <div class="dash-wave">üëã</div>
          <div class="dash-greeting-text">
            <h1>Xin ch√†o, {{ user.first_name|default:user.username }}!</h1>
            <div class="dash-greeting-sub">Ti·∫øp t·ª•c h·ªçc t·∫≠p h√¥m nay</div>
          </div>
        </div>

        <div class="dash-streak">
          <div class="dash-streak-num">
            <span class="dash-streak-fire">üî•</span>
            <span class="dash-streak-value" id="streak-number" data-streak="{{ streak.current_streak|default:0 }}">{{ streak.current_streak|default:0 }}</span>
            <span class="dash-streak-unit">ng√†y</span>
          </div>
          <div class="dash-streak-days">
            {% for day in week_days %}
            <div class="dash-streak-dot {% if day.is_today %}dash-streak-dot--today{% elif day.studied %}dash-streak-dot--on{% else %}dash-streak-dot--off{% endif %}">
              {{ day.label }}
            </div>
            {% empty %}
            <div class="dash-streak-dot dash-streak-dot--off">T2</div>
            <div class="dash-streak-dot dash-streak-dot--off">T3</div>
            <div class="dash-streak-dot dash-streak-dot--today">T4</div>
            <div class="dash-streak-dot dash-streak-dot--off">T5</div>
            <div class="dash-streak-dot dash-streak-dot--off">T6</div>
            <div class="dash-streak-dot dash-streak-dot--off">T7</div>
            <div class="dash-streak-dot dash-streak-dot--off">CN</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Divider -->
      <div class="dash-divider"></div>

      <!-- Stats Row -->
      <div class="dash-stats">
        <a href="{% url 'vocab:my_words' %}?filter=mastered" class="dash-stat">
          <div class="dash-stat-value dash-stat-value--green">{{ vocab_stats.mastered|default:0 }}</div>
          <div class="dash-stat-label">ƒê√£ thu·ªôc</div>
        </a>
        <a href="{% url 'vocab:my_words' %}?filter=learning" class="dash-stat">
          <div class="dash-stat-value dash-stat-value--amber">{{ vocab_stats.learning|default:0 }}</div>
          <div class="dash-stat-label">ƒêang h·ªçc</div>
        </a>
        <a href="{% url 'vocab:my_words' %}?filter=all" class="dash-stat">
          <div class="dash-stat-value dash-stat-value--indigo">{{ vocab_stats.total|default:0 }}</div>
          <div class="dash-stat-label">T·ªïng t·ª´</div>
        </a>
        <div class="dash-stat">
          <div class="dash-stat-value dash-stat-value--rose">{{ vocab_stats.progress|default:"0%" }}</div>
          <div class="dash-stat-label">Ti·∫øn ƒë·ªô</div>
        </div>
      </div>
    </header>

    <!-- ========== TODAY'S MISSION ========== -->
    {% if lesson and lesson.recommended_activities %}
    <section class="mission-section">
      <div class="section-label">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
        Nhi·ªám v·ª• h√¥m nay
      </div>
      <div class="mission-list">
        {% for activity in lesson.recommended_activities|slice:":2" %}
        <a href="{% if activity.type == 'vocab_review' %}{% url 'vocab:set_list' %}?tab=my{% else %}#{% endif %}" class="mission-item">
          <div class="mission-icon {% if activity.type == 'vocab_review' %}mission-icon--review{% else %}mission-icon--milestone{% endif %}">
            {% if activity.type == 'vocab_review' %}
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            {% else %}
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            {% endif %}
          </div>
          <div class="mission-content">
            <div class="mission-title">{{ activity.reason }}</div>
            <div class="mission-meta">{{ activity.estimated_minutes|floatformat:0 }} ph√∫t</div>
          </div>
          <span class="mission-btn {% if activity.type == 'vocab_review' %}mission-btn--pulse{% endif %}">B·∫Øt ƒë·∫ßu</span>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- ========== QUICK ACTIONS ========== -->
    <section class="quick-actions">
      <div class="section-label">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
        </svg>
        Thao t√°c nhanh
      </div>
      <div class="quick-grid">
        <a href="{% url 'vocab:set_list' %}" class="glass-panel-light quick-btn">
          <div class="quick-icon quick-icon--blue">‚ûï</div>
          <span class="quick-label">Th√™m t·ª´ m·ªõi</span>
        </a>
        <a href="{% url 'vocab:my_words' %}" class="glass-panel-light quick-btn">
          <div class="quick-icon quick-icon--amber">‚ö°</div>
          <span class="quick-label">Luy·ªán t·∫≠p</span>
        </a>
        <a href="{% url 'vocab:course_list' %}" class="glass-panel-light quick-btn">
          <div class="quick-icon quick-icon--green">üõ§Ô∏è</div>
          <span class="quick-label">L·ªô tr√¨nh</span>
        </a>
        <a href="{% url 'core:profile' %}" class="glass-panel-light quick-btn">
          <div class="quick-icon quick-icon--rose">üèÜ</div>
          <span class="quick-label">X·∫øp h·∫°ng</span>
        </a>
      </div>
    </section>

    <!-- ========== CONTENT GRID ========== -->
    <section class="content-grid">
      <!-- Learning Vocabulary Sets -->
      <article class="glass-panel content-panel">
        <div class="panel-header">
          <h2 class="panel-title">üìö B·ªô t·ª´ v·ª±ng ƒëang h·ªçc</h2>
          <a href="{% url 'vocab:course_list' %}" class="panel-link">Xem t·∫•t c·∫£ ‚Üí</a>
        </div>
        {% if user_vocab_sets %}
          {% for vocab_set in user_vocab_sets|slice:":2" %}
          <a href="{% url 'vocab:set_detail' vocab_set.id %}" class="course-ticket">
            <div class="course-icon">{{ vocab_set.title|slice:":2"|upper }}</div>
            <div class="course-info">
              <div class="course-title">{{ vocab_set.title }}</div>
              <div class="course-meta">{{ vocab_set.mastered_count|default:0 }}/{{ vocab_set.total_count|default:0 }} t·ª´ ƒë√£ thu·ªôc</div>
            </div>
            <svg class="course-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <p>B·∫°n ch∆∞a h·ªçc b·ªô t·ª´ v·ª±ng n√†o.</p>
            <a href="{% url 'vocab:course_list' %}">Kh√°m ph√° b·ªô t·ª´ v·ª±ng ‚Üí</a>
          </div>
        {% endif %}
      </article>
      <!-- My Courses -->
      <article class="glass-panel content-panel">
        <div class="panel-header">
          <h2 class="panel-title">üìö Kh√≥a h·ªçc c·ªßa t√¥i</h2>
          <a href="{% url 'core:course_list' %}" class="panel-link">Xem t·∫•t c·∫£ ‚Üí</a>
        </div>
        {% if enrolled_courses %}
          {% for enrollment in enrolled_courses|slice:":2" %}
          <a href="{% url 'core:course_detail' enrollment.course.slug %}" class="course-ticket">
            <div class="course-icon">{{ enrollment.course.title|slice:":2"|upper }}</div>
            <div class="course-info">
              <div class="course-title">{{ enrollment.course.title }}</div>
              <div class="course-meta">{% if enrollment.progress %}{{ enrollment.progress }}% ho√†n th√†nh{% else %}Ch∆∞a b·∫Øt ƒë·∫ßu{% endif %}</div>
            </div>
            <svg class="course-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <p>B·∫°n ch∆∞a ƒëƒÉng k√Ω kh√≥a h·ªçc n√†o.</p>
            <a href="{% url 'core:course_list' %}">Kh√°m ph√° kh√≥a h·ªçc ‚Üí</a>
          </div>
        {% endif %}
      </article>

      <!-- Exam Results -->
      <article class="glass-panel content-panel">
        <div class="panel-header">
          <h2 class="panel-title">üìä K·∫øt qu·∫£ luy·ªán thi</h2>
          <a href="{% url 'core:profile' %}" class="panel-link">Xem t·∫•t c·∫£ ‚Üí</a>
        </div>
        {% if recent_exam_results %}
          {% for result in recent_exam_results|slice:":3" %}
          <a href="{% url 'exam:exam_result' result.id %}" class="exam-result">
            <div class="exam-score {% if result.score >= 80 %}exam-score--high{% elif result.score >= 60 %}exam-score--medium{% else %}exam-score--low{% endif %}">
              {{ result.score|floatformat:0 }}%
            </div>
            <div class="exam-info">
              <div class="exam-title">{{ result.template.title }}</div>
              <div class="exam-meta">{{ result.submitted_at|date:"d/m/Y" }} ‚Ä¢ {{ result.correct_count }}/{{ result.total_questions }}</div>
            </div>
          </a>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <p>B·∫°n ch∆∞a l√†m b√†i thi n√†o.</p>
            <a href="{% url 'exam:exam_list' %}">L√†m b√†i thi ngay ‚Üí</a>
          </div>
        {% endif %}
      </article>
    </section>

    <!-- ========== NEW EXAMS ========== -->
    {% if latest_exams %}
    <section class="exams-section">
      <div class="section-label">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        ƒê·ªÅ thi m·ªõi
      </div>
      <div class="exams-scroll">
        {% for exam in latest_exams|slice:":8" %}
        <a href="{% url 'exam:exam_detail' exam.slug %}" class="glass-panel-light exam-card">
          <div class="exam-card-icon">üìÑ</div>
          <div class="exam-card-title">{{ exam.title|truncatechars:30 }}</div>
          <div class="exam-card-meta">{{ exam.total_questions }} c√¢u</div>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% endif %}

  </div>
</div>

{% if user.is_authenticated and streak and streak.current_streak > 0 %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const el = document.getElementById('streak-number');
  if (!el) return;
  const target = parseInt(el.dataset.streak, 10) || 0;
  let current = 0;
  const duration = 600;
  const start = performance.now();

  function animate(now) {
    const progress = Math.min((now - start) / duration, 1);
    current = Math.round(progress * target);
    el.textContent = current;
    if (progress < 1) requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
});
</script>
{% endif %}
{% endblock %}
