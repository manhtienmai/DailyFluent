{# templates/home.html #}
{% extends "base.html" %}

{% block title %}DailyFluent - Dashboard{% endblock %}

{% block main_classes %}max-w-4xl mx-auto px-4 py-8{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- HEADER DASHBOARD -->
  <div class="flex items-center justify-between gap-3">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Dashboard</p>
      <h1 class="text-2xl sm:text-3xl font-bold text-slate-900">
        Xin chÃ o{% if user.is_authenticated and user.email %}, {{ user.email }}{% endif %} ğŸ‘‹
      </h1>
      <p class="text-sm text-slate-600 mt-1">
        Theo dÃµi chuá»—i ngÃ y há»c tiáº¿ng Nháº­t liÃªn tá»¥c cá»§a báº¡n.
      </p>
    </div>

    {% if user.is_authenticated %}
      <div class="hidden sm:block text-right text-xs text-slate-500">
        <p>ÄÃ£ Ä‘Äƒng nháº­p</p>
        <p class="font-medium text-slate-700">Tiáº¿p tá»¥c giá»¯ nhá»‹p má»—i ngÃ y nhÃ©!</p>
      </div>
    {% endif %}
  </div>

  {% if user.is_authenticated %}
    <!-- CARD STREAK CHÃNH -->
    <section class="bg-white border border-slate-100 rounded-3xl shadow-sm p-5 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div class="flex items-center gap-4">
          <div class="h-12 w-12 rounded-2xl bg-orange-100 flex items-center justify-center">
            <span class="text-2xl">ğŸ”¥</span>
          </div>
          <div>
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide">
              Chuá»—i ngÃ y há»c liÃªn tá»¥c
            </p>

            {% if streak and streak.current_streak > 0 %}
              <p class="text-3xl font-bold text-slate-900" id="streak-number" data-streak="{{ streak.current_streak }}">
                {{ streak.current_streak }}
              </p>
              <p class="text-xs text-slate-500 mt-1">
                Ká»· lá»¥c dÃ i nháº¥t:
                <span class="font-semibold text-slate-800">{{ streak.longest_streak }} ngÃ y</span>
              </p>
            {% else %}
              <p class="text-sm text-slate-700 mt-1">
                Báº¡n chÆ°a cÃ³ streak nÃ o. Báº¯t Ä‘áº§u ngay hÃ´m nay báº±ng cÃ¡ch hoÃ n thÃ nh 1 bÃ i há»c hoáº·c Ã´n tá»« vá»±ng. âœ¨
              </p>
            {% endif %}
          </div>
        </div>

        <div class="flex flex-col items-start sm:items-end gap-2">
          <p class="text-xs text-slate-500">
            Má»¥c tiÃªu gá»£i Ã½: Ã­t nháº¥t <span class="font-semibold">10â€“15 phÃºt</span> há»c má»—i ngÃ y.
          </p>
          <div class="flex flex-wrap gap-2">
            <a href="{% url 'vocab:list' %}"
               class="inline-flex items-center justify-center px-4 py-2 rounded-full bg-blue-600 text-white text-xs font-semibold hover:bg-blue-700">
              Ã”n tá»« vá»±ng ngay
            </a>
            <a href="{% url 'video:list' %}"
               class="inline-flex items-center justify-center px-4 py-2 rounded-full border border-slate-200 text-xs text-slate-700 hover:bg-slate-50">
              Xem video luyá»‡n nghe
            </a>
          </div>
        </div>
      </div>

      {% if streak and streak.current_streak > 0 %}
        <div class="mt-5 grid sm:grid-cols-2 gap-3 text-xs">
          <div class="bg-slate-50 rounded-2xl p-3">
            <p class="text-[11px] text-slate-500 mb-1">Tráº¡ng thÃ¡i hiá»‡n táº¡i</p>
            <p class="text-sm font-semibold text-slate-800">
              Báº¡n Ä‘ang giá»¯ chuá»—i {{ streak.current_streak }} ngÃ y liÃªn tá»¥c. Äá»«ng Ä‘á»ƒ bá»‹ ngáº¯t nhÃ©!
            </p>
          </div>
          <div class="bg-slate-50 rounded-2xl p-3">
            <p class="text-[11px] text-slate-500 mb-1">Gá»£i Ã½ hÃ´m nay</p>
            <p class="text-sm text-slate-800">
              HoÃ n thÃ nh 1 video hoáº·c 1 bá»™ tá»« vá»±ng lÃ  Ä‘á»§ Ä‘á»ƒ giá»¯ streak. KhÃ´ng cáº§n há»c quÃ¡ nhiá»u má»™t lÃºc.
            </p>
          </div>
        </div>
      {% endif %}
    </section>

  {% else %}
    <!-- CHÆ¯A ÄÄ‚NG NHáº¬P: Gá»¢I Ã LOGIN -->
    <section class="bg-white border border-slate-100 rounded-3xl shadow-sm p-6 text-center">
      <h2 class="text-lg font-semibold text-slate-900 mb-2">
        ÄÄƒng nháº­p Ä‘á»ƒ xem dashboard há»c táº­p cá»§a báº¡n
      </h2>
      <p class="text-sm text-slate-600 mb-4">
        Báº¡n sáº½ xem Ä‘Æ°á»£c chuá»—i ngÃ y há»c liÃªn tá»¥c (streak), tiáº¿n Ä‘á»™ vÃ  gá»£i Ã½ bÃ i há»c má»—i ngÃ y.
      </p>
      <div class="flex flex-wrap items-center justify-center gap-3">
        <a href="{% url 'account_login' %}"
           class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700">
          ÄÄƒng nháº­p
        </a>
        <a href="{% url 'account_signup' %}"
           class="inline-flex items-center justify-center px-4 py-2.5 rounded-lg border border-slate-200 text-sm text-slate-700 hover:bg-slate-50">
          Táº¡o tÃ i khoáº£n má»›i
        </a>
      </div>
    </section>
  {% endif %}
</div>

{% if user.is_authenticated and streak and streak.current_streak > 0 %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.getElementById('streak-number');
    if (!el) return;
    const target = parseInt(el.dataset.streak, 10) || 0;
    let current = 0;
    const duration = 600;
    const start = performance.now();

    function animate(now) {
      const progress = Math.min((now - start) / duration, 1);
      current = Math.round(progress * target);
      el.textContent = current;
      if (progress < 1) requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
  });
</script>
{% endif %}
{% endblock %}
