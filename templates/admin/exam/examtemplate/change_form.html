{% extends "admin/change_form.html" %}
{% load i18n %}

{# Custom header: Simple title + exit button #}
{% block content %}
<style>
  /* Hide default Django admin header title */
  #content h1:first-of-type {
    display: none !important;
  }
  
  /* Custom simple header */
  .df-exam-template-header {
    margin-bottom: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e2e8f0;
    position: static; /* Not sticky */
  }
  
  .df-exam-template-header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  
  .df-exam-template-title {
    margin: 0;
    font-size: 0.8rem; /* 20% smaller than 1rem (0.8rem = 80% of 1rem) */
    font-weight: 600;
    color: #1e293b;
  }
  
  .df-exam-template-exit-btn {
    padding: 0.375rem 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 0.375rem;
    background: #fff;
    color: #475569;
    font-size: 0.7rem; /* 20% smaller than 0.875rem */
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
  }
  
  .df-exam-template-exit-btn:hover {
    background: #f1f5f9;
    border-color: #94a3b8;
  }
</style>

<div class="df-exam-template-header">
  <div class="df-exam-template-header-inner">
    <h1 class="df-exam-template-title">
      {{ original.title|default:title }}
    </h1>
    <button type="button" 
            onclick="window.history.back()" 
            class="df-exam-template-exit-btn">
      Thoát
    </button>
  </div>
</div>
{{ block.super }}
{% endblock %}

{# Nút import TOEIC JSON chỉ hiện khi level = TOEIC #}
{% block object-tools-items %}
  {{ block.super }}
  {% if original and original.level == "TOEIC" %}
    <li>
      <a class="addlink" href="{% url 'admin:exam_examtemplate_import_toeic_json' original.id %}">
        Import TOEIC JSON
      </a>
    </li>
  {% endif %}
{% endblock %}

{# Ẩn các field JLPT khi chọn level = TOEIC, và ngược lại #}
{% block extrahead %}
  {{ block.super }}
  <script>
    (function () {
      function toggleToeicFields() {
        var levelSelect = document.getElementById("id_level");
        if (!levelSelect) return;

        var isToeic = levelSelect.value === "TOEIC";

        // Các field chỉ dùng cho JLPT (ẩn khi TOEIC)
        var jlptOnlySelectors = [
          ".form-row.field-reading_format",
          ".form-row.field-dokkai_skill"
        ];

        jlptOnlySelectors.forEach(function (sel) {
          document.querySelectorAll(sel).forEach(function (el) {
            el.style.display = isToeic ? "none" : "";
          });
        });

        // TOIEC Settings fieldset: chỉ hiện khi level = TOEIC
        var toeicFieldsets = Array.prototype.slice.call(
          document.querySelectorAll("fieldset.module.aligned.collapse")
        );
        toeicFieldsets.forEach(function (fs) {
          var heading = fs.querySelector("h2.fieldset-heading");
          if (!heading) return;
          if (heading.textContent.indexOf("TOEIC Settings") !== -1) {
            fs.style.display = isToeic ? "" : "none";
          }
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        var levelSelect = document.getElementById("id_level");
        if (!levelSelect) return;

        toggleToeicFields();
        levelSelect.addEventListener("change", toggleToeicFields);
      });
    })();
  </script>
{% endblock %}

