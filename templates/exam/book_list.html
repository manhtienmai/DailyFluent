{% extends "base.html" %}

{% block title %}Sách luyện JLPT | DailyFluent{% endblock %}
{% block main_classes %}df-page-container-lg{% endblock %}

{% block content %}
<h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">
  Sách luyện & Bộ đề JLPT
</h1>

{# ===== THANH FILTER (JLPT tabs + search) ===== #}
<div class="mb-4">
  <form method="get" class="space-y-2">
    {# giữ level hiện tại khi bấm search #}
    <input type="hidden" name="level" value="{{ selected_level }}">

    {# hàng nút level kiểu “pill” #}
    <div class="flex flex-wrap gap-1.5">
      {# Nếu muốn có nút “Tất cả” thì giữ, không thì xoá block này #}
      <button type="submit" name="level" value=""
              class="px-2.5 sm:px-3 py-1 rounded-full text-[11px] sm:text-xs font-semibold border transition
                     {% if not selected_level %}
                       text-white df-pill-active
                     {% else %}
                       text-slate-700 df-pill-default
                     {% endif %}">
        Tất cả
      </button>

      {% for code in levels %}
        <button type="submit" name="level" value="{{ code }}"
                class="px-2.5 sm:px-3 py-1 rounded-full text-[11px] sm:text-xs font-semibold border transition
                       {% if selected_level == code %}
                         text-white df-pill-active
                       {% else %}
                         text-slate-700 df-pill-default
                       {% endif %}">
          JLPT {{ code }}
        </button>
      {% endfor %}
    </div>

    {# ô search nhỏ, gọn #}
    <div class="flex items-center gap-1.5 mt-1.5 bg-white rounded-full border border-slate-200 px-3 py-1.5 shadow-[0_1px_1px_rgba(15,23,42,0.04)]">
      <svg class="w-4 h-4 text-slate-400" viewBox="0 0 24 24" fill="none">
        <path d="M15.5 15.5L20 20" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
              stroke-linejoin="round" />
        <circle cx="11" cy="11" r="5.5" stroke="currentColor" stroke-width="1.8" />
      </svg>
      <input
        type="text"
        name="q"
        value="{{ search_query }}"
        placeholder="Tìm theo tên sách..."
        class="flex-1 bg-transparent border-none focus:outline-none text-xs sm:text-sm text-slate-800 placeholder:text-slate-400"
      />
    </div>
  </form>
</div>

{# ===== KỆ SÁCH (grid cover + Học ngay) ===== #}
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-7">
  {% for book in books %}
    <article class="flex justify-center">
      <a href="{% url 'exam:book_detail' book.slug %}"
         class="group flex flex-col items-center text-center hover:-translate-y-0.5 hover:scale-[1.01] transition-transform">

        {# COVER #}
        <div class="w-full max-w-[190px] aspect-[3/4] bg-white shadow-sm border border-slate-200 rounded-lg overflow-hidden group-hover:shadow-md transition-shadow">
          {% if book.cover_image %}
            <img src="{{ book.cover_image.url }}"
                 alt="{{ book.title }}"
                 class="w-full h-full object-cover">
          {% else %}
            <div class="w-full h-full bg-gradient-to-br from-sky-500/80 via-indigo-500/80 to-slate-900 flex items-center justify-center px-3">
              <span class="text-xs font-semibold text-white leading-snug line-clamp-4">
                {{ book.title }}
              </span>
            </div>
          {% endif %}
        </div>

        {# TITLE #}
        <h2 class="mt-3 text-sm font-semibold text-slate-900 leading-snug line-clamp-2">
          {{ book.title }}
        </h2>
        
        {# STATUS + CTA pill gọn gàng #}
        <p class="mt-1 text-[11px] text-slate-500">
          {% if book.tests.count %}
            {{ book.tests.count }} bài test có sẵn
          {% else %}
            Đang cập nhật bài test
          {% endif %}
        </p>

        <span class="mt-2 inline-flex items-center gap-1 px-3 py-1 rounded-full bg-slate-900 text-white text-[11px] font-semibold group-hover:bg-slate-800">
          Học ngay
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none">
            <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </span>
      </a>
    </article>
  {% empty %}
    <p class="text-slate-600">
      Chưa có Book nào. Hãy seed dữ liệu (ví dụ: <code>Power Drill Mojigoi N2</code>) trước.
    </p>
  {% endfor %}
</div>

{% endblock %}
